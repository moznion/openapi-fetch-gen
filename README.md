# openapi-fetch-gen

Generate TypeScript API client from OpenAPI TypeScript interface definitions created by [openapi-typescript](https://github.com/openapi-ts/openapi-typescript).

This tool takes TypeScript interface definitions generated by `openapi-typescript` and creates a fully typed API client using [openapi-fetch](https://github.com/openapi-ts/openapi-typescript/tree/main/packages/openapi-fetch).

## How It Works

1. Parse the TypeScript definition file generated by `openapi-typescript`
2. Extract all API endpoints, their HTTP methods, and parameter structures
3. Generate typed wrapper functions for each endpoint
4. Export a fully-typed client that provides:
   - A base client instance created with `createClient` from `openapi-fetch`
   - Individual typed functions for each API endpoint
   - Type helpers for parameters and responses

## Installation

```bash
npm install --save-dev openapi-fetch-gen
# or
yarn add -D openapi-fetch-gen
```

Make sure you also have `openapi-fetch` installed:

```bash
npm install openapi-fetch
# or
yarn add openapi-fetch
```

## Usage

### CLI

```bash
npx openapi-fetch-gen --input ./schema.d.ts --output ./client.ts
```

Options:

- `-i, --input <path>`: Path to input OpenAPI TypeScript definition file (required)
- `-o, --output <path>`: Path to output generated client file (default: `./client.ts`)
- `-p, --paths-type <name>`: Paths interface type name (default: `paths`)
- `-c, --components-type <name>`: Components interface type name (default: `components`)
- `-b, --base-url <url>`: Base URL for the API client (default: `https://example.com/`)

### Programmatic Usage

```typescript
import { generateClient } from 'openapi-fetch-gen';
import fs from 'fs';

const clientCode = generateClient({
  schemaPath: './schema.d.ts',
  pathsTypeName: 'paths', // optional, defaults to 'paths'
  componentsTypeName: 'components', // optional, defaults to 'components'
  baseUrl: 'https://api.example.com', // optional, defaults to 'https://example.com/'
});

fs.writeFileSync('./client.ts', clientCode);
```

## Example

### Input Schema (schema.d.ts)

```typescript
export interface paths {
  "/v1/users": {
    get: {
      parameters: {
        query: {
          page?: number;
          limit?: number;
        };
        header: {
          "X-API-Key": string;
        };
        path?: never;
        cookie?: never;
      };
      requestBody?: never;
      responses: {
        200: {
          content: {
            "application/json": {
              users: {
                id: string;
                name: string;
                email: string;
              }[];
              total: number;
            };
          };
        };
        400: { ... };
        401: { ... };
      };
    };
    post: {
      parameters: { ... };
      requestBody: {
        content: {
          "application/json": {
            name: string;
            email: string;
            password: string;
          };
        };
      };
      responses: { ... };
    };
  };
  // ... more paths
}
```

### Generated Client (client.ts)

```typescript
import createClient, { ClientOptions } from "openapi-fetch";
import type { components, paths } from "./schema"; // generated by openapi-typescript

export class Client {
    private readonly client;

    constructor(clientOptions?: ClientOptions) {
        this.client = createClient<paths>(clientOptions || { baseUrl: "https://api.example.com" });
    }

    /**
     * List all users
     */
    async getUsers(
        params: {
            query: {
                /** Page number */
                page?: number,
                /** Number of items per page */
                limit?: number,
            },
            header: {
                /** API key for authentication */
                "X-API-Key": string,
            },
        }
    ) {
        return await this.client.GET("/users", {
            params,
        });
    }

    /**
     * Create a new user
     */
    async postUsers(
        params: {
            header: {
                /** API key for authentication */
                "X-API-Key": string,
            },
        },
        body: {
            name: string,
            email: string,
            password: string,
        }
    ) {
        return await this.client.POST("/users", {
            params,
            body,
        });
    }

    /**
     * Get a user by ID
     */
    async getUsersId(
        params: {
            path: {
                /** User ID */
                id: string,
            },
            header: {
                /** API key for authentication */
                "X-API-Key": string,
            },
        }
    ) {
        return await this.client.GET("/users/{id}", {
            params,
        });
    }

    // ... additional methods for other endpoints
}
```

### Using the Generated Client

```typescript
import { Client } from './client';

// Create a client instance with custom options or use the default
const client = new Client({ baseUrl: "https://api.example.com" });

async function example() {
  // Get users
  const { data: usersData, error: usersError } = await client.getUsers({
    query: {
      page: 1,
      limit: 10
    },
    header: {
      "X-API-Key": "your-api-key"
    }
  });

  if (usersError) {
    console.error('Error fetching users:', usersError);
    return;
  }

  console.log(`Found ${usersData?.users.length} users out of ${usersData?.total} total`);

  // Create user
  const { data: newUser, error: createError } = await client.postUsers(
    {
      header: {
        "X-API-Key": "your-api-key"
      }
    },
    {
      name: "John Doe",
      email: "john@example.com",
      password: "securepassword"
    }
  );

  if (createError) {
    console.error('Error creating user:', createError);
    return;
  }

  // Get a specific user
  const { data: user } = await client.getUsersId({
    path: {
      id: newUser?.id || 'user-123'
    },
    header: {
      "X-API-Key": "your-api-key"
    }
  });

  console.log('User details:', user);
}
```

## License

MIT