# openapi-fetch-gen [![Run Tests](https://github.com/moznion/openapi-fetch-gen/actions/workflows/test.yml/badge.svg)](https://github.com/moznion/openapi-fetch-gen/actions/workflows/test.yml)

Generate TypeScript API client from OpenAPI TypeScript interface definitions created by [openapi-typescript](https://github.com/openapi-ts/openapi-typescript).

This tool takes TypeScript interface definitions generated by `openapi-typescript` and creates a fully typed API client using [openapi-fetch](https://github.com/openapi-ts/openapi-typescript/tree/main/packages/openapi-fetch).

## How It Works

1. Parse the TypeScript schema file generated by `openapi-typescript`
2. Extract all API endpoints, their HTTP methods, and parameter structures from the schema
3. Generate typed wrapper functions for each endpoint
4. Export a fully-typed client that provides:
   - A base client instance created with `createClient` from `openapi-fetch`
   - Individual typed functions for each API endpoint
   - Type helpers for parameters and responses

## Installation

```bash
npm install --save-dev @moznion/openapi-fetch-gen
```

## Usage

### CLI

```bash
npx openapi-fetch-gen --input ./schema.d.ts --output ./client.ts
```

Options:

```
  -V, --version                                         output the version number
  -i, --input <path>                                    path to input OpenAPI TypeScript definition file
  -o, --output <path>                                   path to output generated client file (default: "./client.ts")
  --default-headers <comma_separated_names_of_headers>  header names so that the generated client includes the default HTTP headers across all endpoints (default: "")
  -h, --help                                            display help for command
```

### Example

Please refer to the [examples](./examples/).

`schema.d.ts` is generated from `schema.yaml` by `openapi-typescript`, and `generated_client.ts` is generated by this tool according to the `schema.d.ts`.

FYI, you can use the generated client as follows:

```typescript
import { Client } from "./generated_client";

async function doSomething() {
  const client = new Client({ baseUrl: "https://api.example.com" });
  const users = await client.getUsers({
    query: {
      page: 1,
      pageSize: 10,
      membershipType: "PREMIUM",
    },
  });

  for (const user of users.data?.items ?? []) {
    console.log(`User: ${user.name}, Email: ${user.email}`);
  }
}
```

### Default HTTP Headers

This tool provides a `--default-headers` CLI option to configure the generated client to use default HTTP headers.

For example, when you specify:

```bash
npx openapi-fetch-gen \
  --input ./schema.d.ts \
  --output ./client.ts \
  --default-headers "Authorization, Application-Version"
```

the `Client` constructor accepts those default values:

```typescript
type DefaultHeaders = Record<'Authorization' | 'Application-Version', string>;

export class Client {
  constructor(clientOptions: ClientOptions, defaultHeaders: DefaultHeaders) { ... }
}
```

Endpoint methods that require those headers no longer need the default values to be passed explicitly.

For example, given this schema:

```typescript
"/users/bulk/{jobId}": {
  get: {
    parameters: {
      query?: never;
      header: {
        /** @description Authorization Header */
        Authorization: string;
        /** @description Application version */
        "Application-Version": string;
        /** @description Identifier of something */
        "Something-Id": string;
      };
      path: {
        /** @description Bulk import job identifier */
        jobId: string;
      };
      cookie?: never;
    };
```

When `--default-headers` is not specified, the generated client method looks like this:

```typescript
async getUsersBulkJobid(params: {
  header: {
    Authorization: string;
    "Application-Version": string;
    "Something-Id": string;
  };
  path: { jobId: string };
}) {
  ...
}
```

This requires you to pass all header values explicitly.

When you do specify `--default-headers`, the signature becomes:

```typescript
async getUsersBulkJobid(
  params: keyof Omit<
    {
      Authorization: string;
      "Application-Version": string;
      "Something-Id": string;
    },
    keyof DefaultHeaders
  > extends never
    ? {
        header?: {
          Authorization: string;
          "Application-Version": string;
          "Something-Id": string;
        };
        path: { jobId: string };
      }
    : {
        header:
          | Omit<
              {
                Authorization: string;
                "Application-Version": string;
                "Something-Id": string;
              },
              keyof DefaultHeaders
            >
          | {
              Authorization: string;
              "Application-Version": string;
              "Something-Id": string;
            };
        path: { jobId: string };
      },
) {
  ...
}
```

That signature means you can:

- **Omit** the defaulted headers and only pass additional ones (here, `Something-Id`):

```typescript
client.getUsersBulkJobid({header: {"something-Id": "foobar"}, path: {jobId: "123"}});
```

- **Override** all headers, including the defaults:

```typescript
client.getUsersBulkJobid({header: {"Authorization": "foo", "Application-Version": "bar", "something-Id": "foobar"}, path: {jobId: "123"}});
```

If your default headers cover **all** required headers for the endpoint (e.g. `--default-headers 'Authorization, Application-Version, Something-Id'`), you can omit the `header` parameter entirely:

```typescript
client.getUsersBulkJobid({path: {jobId: "123"}});
```

## License

MIT

